# Резервное копирование и восстановление

> **Русская версия является официальной**

AVA AIGC Toolbox предоставляет надежные функции резервного копирования и восстановления для защиты вашей библиотеки изображений. В этом руководстве описано, как создать резервную копию вашей библиотеки и восстановить ее при необходимости.

## Понимание структуры библиотеки

Перед созданием резервной копии вашей библиотеки важно понять ее структуру:

- **Файл базы данных**: Содержит все метаданные, теги, альбомы и организационную информацию
- **Файлы изображений**: Собственные файлы изображений хранятся в вашей файловой системе
- **Кэш эскизов**: Содержит сгенерированные эскизы для более быстрого просмотра

## Опции резервного копирования

### 1. Резервное копирование базы данных

Самый важный компонент для резервного копирования - это файл базы данных, который содержит всю вашу организационную информацию:

#### Шаги для создания резервной копии базы данных:
1. Перейдите в `Файл > Резервное копирование библиотеки` или нажмите кнопку **Резервное копирование** на панели инструментов
2. В диалоговом окне резервного копирования выберите **Только база данных** как тип резервного копирования
3. Выберите целевую папку для резервной копии
4. Введите имя для файла резервной копии
5. Нажмите **Резервное копирование**, чтобы начать процесс
6. Отслеживайте прогресс в диалоговом окне
7. Нажмите **Готово**, когда закончите

### 2. Полное резервное копирование

Полное резервное копирование включает в себя:
- Файл базы данных
- Кэш эскизов
- Опционально: Файлы изображений (если они хранятся в управляемом месте)

#### Шаги для выполнения полного резервного копирования:
1. Перейдите в `Файл > Резервное копирование библиотеки`
2. В диалоговом окне резервного копирования выберите **Полное резервное копирование** как тип резервного копирования
3. Выберите целевую папку для резервной копии
4. Настройте параметры резервного копирования:
   - **Включить файлы изображений**: Включить сами файлы изображений в резервную копию
   - **Сжать резервную копию**: Создать сжатый файл резервной копии
   - **Зашифровать резервную копию**: Зашифровать резервную копию паролем
5. Нажмите **Резервное копирование**, чтобы начать процесс
6. Отслеживайте прогресс в диалоговом окне
7. Нажмите **Готово**, когда закончите

### 3. Автоматическое резервное копирование

Вы можете настроить приложение для автоматического резервного копирования вашей библиотеки:

#### Шаги для настройки автоматического резервного копирования:
1. Перейдите в `Настройки > Библиотека > Резервное копирование`
2. Установите флажок **Включить автоматическое резервное копирование**
3. Настройте параметры резервного копирования:
   - **Частота резервного копирования**: Как часто создавать резервные копии (ежедневно, еженедельно, ежемесячно)
   - **Время резервного копирования**: Время суток для выполнения резервного копирования
   - **Тип резервного копирования**: Только база данных или полное резервное копирование
   - **Целевая папка**: Где хранить резервные копии
   - **Хранить резервные копии в течение**: Как долго хранить старые резервные копии
   - **Максимальное количество резервных копий**: Максимальное количество резервных копий для хранения
4. Нажмите **Сохранить**, чтобы включить автоматическое резервное копирование

## Восстановление из резервной копии

### 1. Восстановление базы данных

#### Шаги для восстановления базы данных:
1. Закройте приложение (рекомендуется)
2. Перейдите в `Файл > Восстановить библиотеку`
3. В диалоговом окне восстановления выберите **Только база данных** как тип восстановления
4. Нажмите **Обзор** и выберите файл резервной копии
5. Настройте параметры восстановления:
   - **Перезаписать существующую базу данных**: Заменить текущую базу данных
   - **Проверить целостность резервной копии**: Проверить, является ли файл резервной копии действительным
6. Нажмите **Восстановить**, чтобы начать процесс
7. Отслеживайте прогресс в диалоговом окне
8. Нажмите **Готово**, когда закончите
9. Перезапустите приложение, чтобы изменения вступили в силу

### 2. Полное восстановление

#### Шаги для выполнения полного восстановления:
1. Закройте приложение (рекомендуется)
2. Перейдите в `Файл > Восстановить библиотеку`
3. В диалоговом окне восстановления выберите **Полное восстановление** как тип восстановления
4. Нажмите **Обзор** и выберите файл резервной копии
5. Выберите целевую папку для восстановления
6. Настройте параметры восстановления:
   - **Перезаписывать существующие файлы**: Заменить существующие файлы восстановленными файлами
   - **Проверить целостность резервной копии**: Проверить, является ли файл резервной копии действительным
   - **Восстановить файлы изображений**: Восстановить сами файлы изображений
   - **Восстановить кэш эскизов**: Восстановить кэш эскизов
7. Нажмите **Восстановить**, чтобы начать процесс
8. Отслеживайте прогресс в диалоговом окне
9. Нажмите **Готово**, когда закончите
10. Перезапустите приложение, чтобы изменения вступили в силу

## Управление файлами резервных копий

### Просмотр истории резервных копий

#### Шаги для просмотра истории резервных копий:
1. Перейдите в `Настройки > Библиотека > Резервное копирование`
2. Прокрутите вниз до раздела **История резервных копий**
3. Просмотрите список существующих резервных копий
4. Щелкните по резервной копии, чтобы просмотреть детали:
   - Дата и время резервного копирования
   - Тип резервного копирования
   - Размер файла
   - Местоположение резервной копии
5. Используйте кнопки для:
   - **Просмотреть резервную копию**: Открыть месторасположение файла резервной копии
   - **Удалить резервную копию**: Удалить файл резервной копии
   - **Восстановить из резервной копии**: Восстановить из этой резервной копии

### Управление файлами резервных копий

- **Местоположение резервных копий**: По умолчанию резервные копии хранятся в:
  - Windows: `%APPDATA%/AIGenManager/Backups/`
  - macOS: `~/.local/share/AIGenManager/Backups/`
  - Linux: `~/.local/share/AIGenManager/Backups/`

- **Ручное управление резервными копиями**: 
  - Вы можете вручную копировать файлы резервных копий на внешнее хранилище
  - Храните резервные копии в нескольких местах для избыточности
  - Ясно помечайте резервные копии датой и типом

## Лучшие практики для резервного копирования

1. **Резервное копирование регулярно**: Планируйте регулярные резервные копии в зависимости от того, как часто вы добавляете изображения
2. **Используйте несколько мест**: Храните резервные копии в по крайней мере двух разных местах (локальном и внешнем)
3. **Тестируйте восстановление**: Периодически тестируйте восстановление из резервных копий, чтобы убедиться, что они действительны
4. **Резервное копирование перед крупными изменениями**: Всегда создавайте резервную копию перед выполнением пакетных операций или обновлением приложения
5. **Зашифруйте чувствительные резервные копии**: Используйте шифрование для резервных копий, содержащих чувствительные изображения
6. **Храните резервные копии за разные периоды времени**: Храните дневные, еженедельные и ежемесячные резервные копии
7. **Документируйте места хранения резервных копий**: Ведите запись о том, где хранятся ваши резервные копии
8. **Рассмотрите облачное хранилище**: Храните резервные копии в облачном хранилище для защиты за пределами места

## Устранение проблем с резервным копированием

### Резервное копирование не работает
- **Проверьте свободное место на диске**: Убедитесь, что на диске достаточно места в месте назначения резервной копии
- **Проверьте разрешения**: Убедитесь, что у вас есть права на запись в место хранения резервной копии
- **Проверьте блокировки файлов**: Убедитесь, что база данных не заблокирована другим процессом
- **Закройте другие приложения**: Закройте другие приложения, которые могут обращаться к базе данных

### Восстановление не работает
- **Проверьте файл резервной копии**: Убедитесь, что файл резервной копии действителен и не поврежден
- **Проверьте разрешения файлов**: Убедитесь, что у вас есть права на запись в место библиотеки
- **Закройте приложение**: Закройте приложение перед восстановлением, чтобы избежать блокировки файлов
- **Проверьте совместимость версий**: Убедитесь, что резервная копия совместима с вашей текущей версией приложения

### Поврежденная база данных
- **Попробуйте автоматическое восстановление**: Перейдите в `Инструменты > База данных > Восстановить базу данных`
- **Восстановите из резервной копии**: Если восстановление не удалось, восстановите из последней действительной резервной копии
- **Проверьте здоровье диска**: Проверьте ваш жесткий диск на ошибки, если у вас часто возникают проблемы с повреждением

## Оптимизация базы данных

Регулярная оптимизация базы данных может улучшить производительность и снизить риск повреждения:

#### Шаги для оптимизации базы данных:
1. Перейдите в `Инструменты > База данных > Оптимизировать базу данных`
2. В диалоговом окне оптимизации выберите параметры оптимизации:
   - **Сжать базу данных**: Уменьшить размер файла базы данных
   - **Перестроить индексы**: Перестроить индексы базы данных для лучшей производительности
   - **Проверить целостность базы данных**: Проверить целостность базы данных
3. Нажмите **Оптимизировать**, чтобы начать процесс
4. Отслеживайте прогресс в диалоговом окне
5. Нажмите **Готово**, когда закончите

## Экстренное восстановление

Если вы не можете запустить приложение из-за повреждения базы данных:

1. **Найдите файл базы данных**: Найдите файл базы данных в его месте по умолчанию
2. **Переименуйте поврежденную базу данных**: Переименуйте поврежденный файл базы данных (например, `aigenmanager.db.corrupted`)
3. **Запустите приложение**: Приложение создаст новую пустую базу данных
4. **Восстановите из резервной копии**: Используйте вышеописанные шаги для восстановления из вашей последней резервной копии

## Формат файла резервной копии

Файлы резервных копий хранятся в следующих форматах:

- **.db**: Файл базы данных SQLite (для резервных копий только базы данных)
- **.zip**: Сжатый файл резервной копии (для полных резервных копий)
- **.bak**: Зашифрованный файл резервной копии (для зашифрованных резервных копий)

## Миграция на новый компьютер

### Шаги для миграции вашей библиотеки на новый компьютер:
1. На старом компьютере:
   - Выполните полное резервное копирование вашей библиотеки
   - Скопируйте файл резервной копии на внешнее хранилище
   - Запишите месторасположение ваших файлов изображений
2. На новом компьютере:
   - Установите AVA AIGC Toolbox
   - Скопируйте ваши файлы изображений в то же место (или новое место)
   - Откройте приложение
   - Восстановите из файла резервной копии
   - Если вы изменили месторасположение файлов изображений, обновите настройки библиотеки

## Далее

- Узнайте о [Интеграции ИИ](./ai-integration.md) для получения дополнительных функций на основе ИИ
- Прочитайте о [Пакетных операциях](./batch-operations.md) для пакетной обработки изображений
- Изучите [Настройки](../settings.md), чтобы настроить параметры резервного копирования